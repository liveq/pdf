<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>무료 PDF 변환 도구 - JPEG 변환 & PDF 분할 | pdf.baal.co.kr</title>
    <meta name="description" content="PDF를 고품질 JPEG 이미지로 변환하거나 여러 파일로 분할하세요. 무료, 빠르고 안전한 브라우저 기반 PDF 도구. 150/300 DPI 지원, 배치 처리, 페이지 선택 기능 제공.">
    <meta name="keywords" content="PDF to JPEG, PDF 변환, PDF 분할, PDF 나누기, 온라인 PDF 도구, PDF to JPG, 무료 PDF 변환기, PDF 페이지 분리, 고화질 PDF 변환, 150 DPI, 300 DPI">
    <meta name="author" content="baal.co.kr">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://pdf.baal.co.kr">
    <meta name="theme-color" content="#B8860B">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pdf.baal.co.kr">
    <meta property="og:title" content="무료 PDF 변환 도구 - JPEG 변환 & PDF 분할">
    <meta property="og:description" content="PDF를 고품질 JPEG로 변환하거나 여러 파일로 분할하세요. 무료, 빠르고 안전한 브라우저 기반 도구. 150/300 DPI 지원, 배치 처리 가능.">
    <meta property="og:site_name" content="PDF 변환 도구">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:image" content="https://pdf.baal.co.kr/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://pdf.baal.co.kr">
    <meta name="twitter:title" content="무료 PDF 변환 도구 - JPEG 변환 & PDF 분할">
    <meta name="twitter:description" content="PDF를 고품질 JPEG로 변환하거나 여러 파일로 분할하세요. 무료, 빠르고 안전한 브라우저 기반 도구.">
    <meta name="twitter:image" content="https://pdf.baal.co.kr/og-image.jpg">

    <!-- 구조화된 데이터 (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "PDF 변환 도구",
      "alternateName": "PDF Converter Tool",
      "url": "https://pdf.baal.co.kr",
      "description": "PDF 파일을 고품질 JPEG 이미지로 변환하거나 여러 개의 작은 PDF 파일로 분할할 수 있는 무료 온라인 도구입니다.",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "KRW"
      },
      "featureList": [
        "PDF to JPEG 변환 (150/300 DPI)",
        "배치 처리 (최대 3개 파일)",
        "페이지 선택 (전체/범위/특정)",
        "그레이스케일 변환",
        "PDF 분할 (균등/페이지/범위)",
        "다크모드 지원",
        "한국어/영어 지원"
      ],
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "author": {
        "@type": "Organization",
        "name": "baal.co.kr",
        "url": "https://baal.co.kr"
      }
    }
    </script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        :root {
            /* 라이트 모드 색상 */
            --primary-white: #FFFFFF;
            --primary-black: #1A1A1A;
            --accent-gold: #B8860B;
            --text-dark: #333333;
            --text-light: #666666;
            --background-light: #F8F8F8;
            --border-light: #E0E0E0;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.1);
            --transition-base: 0.3s ease;
        }

        [data-theme="dark"] {
            /* 다크 모드 색상 */
            --primary-white: #1A1A1A;
            --primary-black: #FFFFFF;
            --accent-gold: #D4A017;
            --text-dark: #E0E0E0;
            --text-light: #B0B0B0;
            --background-light: #2A2A2A;
            --border-light: #404040;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 5px 15px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--text-dark);
            background: var(--primary-white);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            word-break: keep-all;
            transition: background var(--transition-base), color var(--transition-base);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 24px 80px;
            position: relative;
        }

        /* 유틸리티 버튼 */
        .utility-buttons {
            position: absolute;
            top: 24px;
            right: 24px;
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 1px solid var(--border-light);
            background: var(--primary-white);
            color: var(--text-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all var(--transition-base);
        }

        .icon-btn:hover {
            background: var(--accent-gold);
            color: var(--primary-white);
            border-color: var(--accent-gold);
            transform: translateY(-2px);
        }

        /* 헤더 */
        .header {
            text-align: center;
            margin-bottom: 48px;
            margin-top: 40px;
            animation: fadeInUp 0.8s ease;
        }

        .header h1 {
            font-size: 42px;
            font-weight: 700;
            color: var(--primary-black);
            margin-bottom: 12px;
            letter-spacing: -1px;
            line-height: 1.2;
        }

        .header p {
            font-size: 16px;
            color: var(--text-light);
            line-height: 1.6;
        }

        /* 탭 네비게이션 */
        .tab-navigation {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 48px;
            animation: fadeInUp 0.8s ease 0.1s both;
        }

        .tab-btn {
            padding: 12px 32px;
            border: 2px solid var(--border-light);
            background: var(--primary-white);
            color: var(--text-dark);
            font-size: 16px;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all var(--transition-base);
            font-family: 'Noto Sans KR', sans-serif;
        }

        .tab-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .tab-btn.active {
            background: var(--accent-gold);
            color: var(--primary-white);
            border-color: var(--accent-gold);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 업로드 영역 */
        .upload-area {
            background: var(--background-light);
            border: 2px dashed var(--border-light);
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-base);
            margin-bottom: 32px;
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        .upload-area:hover, .upload-area.drag-over {
            border-color: var(--accent-gold);
            background: var(--primary-white);
            box-shadow: var(--shadow-md);
            transform: scale(1.01);
        }

        .upload-area h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .upload-area p {
            font-size: 14px;
            color: var(--text-light);
        }

        .file-input {
            display: none;
        }

        /* 파일 리스트 */
        .file-list {
            margin-bottom: 32px;
        }

        .file-item {
            background: var(--primary-white);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: fadeInUp 0.3s ease;
        }

        .file-info h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .file-info p {
            font-size: 14px;
            color: var(--text-light);
        }

        .file-remove {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 20px;
            padding: 4px 8px;
            transition: color var(--transition-base);
        }

        .file-remove:hover {
            color: #ef4444;
        }

        /* 옵션 */
        .options {
            background: var(--primary-white);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 32px;
            animation: fadeInUp 0.8s ease 0.3s both;
        }

        .option-group {
            margin-bottom: 24px;
        }

        .option-group:last-child {
            margin-bottom: 0;
        }

        .option-group label {
            display: block;
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 12px;
            color: var(--text-dark);
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .radio-option label {
            margin: 0;
            font-weight: 400;
            cursor: pointer;
        }

        .page-input {
            padding: 10px 12px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--primary-white);
            color: var(--text-dark);
            width: 100%;
            margin-top: 8px;
            transition: border-color var(--transition-base);
        }

        .page-input:focus {
            outline: none;
            border-color: var(--accent-gold);
        }

        .page-input:disabled {
            background: var(--background-light);
            cursor: not-allowed;
        }

        .hint-text {
            font-size: 13px;
            color: var(--text-light);
            margin-top: 6px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
        }

        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .help-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--text-light);
            color: var(--primary-white);
            font-size: 11px;
            font-weight: bold;
            cursor: help;
            position: relative;
            margin-left: 6px;
            transition: all var(--transition-base);
            flex-shrink: 0;
        }

        .help-icon:hover {
            background: var(--accent-gold);
            transform: scale(1.1);
        }

        .help-icon::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 16px;
            background: var(--primary-black);
            color: var(--primary-white);
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-line;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-base);
            pointer-events: none;
            z-index: 10000;
            min-width: 200px;
            max-width: 300px;
            text-align: left;
        }

        .help-icon:hover::after {
            opacity: 1;
            visibility: visible;
        }

        .help-icon::before {
            content: '';
            position: absolute;
            bottom: calc(100% + 4px);
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid var(--primary-black);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-base);
            z-index: 10000;
        }

        .help-icon:hover::before {
            opacity: 1;
            visibility: visible;
        }

        .option-label-with-help {
            display: flex;
            align-items: center;
        }

        /* 버튼 */
        .btn {
            width: 100%;
            padding: 16px 32px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            font-family: 'Noto Sans KR', sans-serif;
        }

        .btn-primary {
            background: var(--accent-gold);
            color: var(--primary-white);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--primary-black);
            color: var(--primary-white);
            margin-top: 12px;
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--text-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* 진행률 */
        .progress-container {
            margin-top: 24px;
        }

        .progress-item {
            margin-bottom: 16px;
        }

        .progress-item:last-child {
            margin-bottom: 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-filename {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .progress-status {
            font-size: 13px;
            color: var(--text-light);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-light);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent-gold);
            transition: width var(--transition-base);
            border-radius: 4px;
        }

        /* Toast 알림 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
            border-left: 4px solid;
            min-width: 300px;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        }

        .toast-success {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
        }

        .toast-error {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
        }

        .toast-warning {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }

        .toast-message {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            line-height: 1.4;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            color: #9ca3af;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 모달 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal {
            background: var(--primary-white);
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            animation: scaleIn 0.3s ease;
        }

        .modal h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-black);
            margin-bottom: 16px;
        }

        .modal p {
            font-size: 15px;
            color: var(--text-dark);
            line-height: 1.6;
            margin-bottom: 24px;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px 24px;
            border: none;
            border-radius: 50px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            font-family: 'Noto Sans KR', sans-serif;
        }

        .modal-btn-primary {
            background: var(--accent-gold);
            color: var(--primary-white);
        }

        .modal-btn-secondary {
            background: var(--background-light);
            color: var(--text-dark);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        /* 애니메이션 */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        .hidden {
            display: none !important;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px 60px;
            }

            .utility-buttons {
                top: 16px;
                right: 16px;
            }

            .header h1 {
                font-size: 32px;
            }

            .header p {
                font-size: 14px;
            }

            .tab-navigation {
                gap: 8px;
            }

            .tab-btn {
                padding: 10px 20px;
                font-size: 14px;
            }

            .upload-area {
                padding: 40px 20px;
            }

            .options {
                padding: 24px;
            }

            .toast {
                left: 20px;
                right: 20px;
                min-width: auto;
                max-width: none;
            }

            .modal {
                padding: 24px;
            }

            .modal-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 유틸리티 버튼 -->
        <div class="utility-buttons">
            <button class="icon-btn" id="langToggle" title="Language / 언어">🌐</button>
            <button class="icon-btn" id="themeToggle" title="Dark Mode / 다크 모드">🌙</button>
        </div>

        <!-- 헤더 -->
        <div class="header">
            <h1 data-ko="PDF 변환 도구" data-en="PDF Converter Tool">PDF 변환 도구</h1>
            <p data-ko="PDF를 JPEG로 변환하거나 여러 파일로 분할하세요" data-en="Convert PDF to JPEG or split into multiple files">PDF를 JPEG로 변환하거나 여러 파일로 분할하세요</p>
        </div>

        <!-- 탭 네비게이션 -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="jpeg" data-ko="PDF → JPEG" data-en="PDF → JPEG">PDF → JPEG</button>
            <button class="tab-btn" data-tab="split" data-ko="PDF 분할" data-en="PDF Split">PDF 분할</button>
        </div>

        <!-- PDF to JPEG 탭 -->
        <div id="jpeg-tab" class="tab-content active">
            <div class="upload-area" id="jpegUploadArea">
                <input type="file" id="jpegFileInput" class="file-input" accept=".pdf" multiple>
                <h3 data-ko="PDF 파일 선택" data-en="Select PDF Files">PDF 파일 선택</h3>
                <p data-ko="클릭하거나 드래그하여 PDF 파일 업로드 (최대 3개, 20MB 이하)" data-en="Click or drag to upload PDF files (max 3 files, 20MB each)">클릭하거나 드래그하여 PDF 파일 업로드 (최대 3개, 20MB 이하)</p>
            </div>

            <div id="jpegFileList" class="file-list hidden"></div>

            <div id="jpegOptions" class="options hidden">
                <!-- 페이지 선택 -->
                <div class="option-group">
                    <label data-ko="페이지 선택 (택1)" data-en="Page Selection">페이지 선택 (택1)</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="allPages" name="pageSelection" value="all" checked>
                            <div class="option-label-with-help">
                                <label for="allPages" data-ko="전체 페이지" data-en="All Pages">전체 페이지</label>
                                <span class="help-icon" data-tooltip="PDF의 모든 페이지를 JPEG로 변환합니다.&#10;&#10;예: 100페이지 PDF → 100개 이미지">ⓘ</span>
                            </div>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="pageRange" name="pageSelection" value="range">
                            <div class="option-label-with-help">
                                <label for="pageRange" data-ko="페이지 범위" data-en="Page Range">페이지 범위</label>
                                <span class="help-icon" data-tooltip="시작 페이지부터 끝 페이지까지 변환합니다.&#10;&#10;예: 3-5 입력 시 → 3, 4, 5 페이지만 변환">ⓘ</span>
                            </div>
                            <input type="text" id="rangeInput" class="page-input" placeholder="3-5" disabled>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="specificPages" name="pageSelection" value="specific">
                            <div class="option-label-with-help">
                                <label for="specificPages" data-ko="특정 페이지" data-en="Specific Pages">특정 페이지</label>
                                <span class="help-icon" data-tooltip="원하는 페이지만 선택해서 변환합니다.&#10;&#10;쉼표(,)로 페이지 구분&#10;하이픈(-)으로 범위 지정&#10;&#10;예: 1,3,5-8 입력 시&#10;→ 1, 3, 5, 6, 7, 8 페이지 변환">ⓘ</span>
                            </div>
                            <input type="text" id="specificInput" class="page-input" placeholder="1,3,5-8" disabled>
                        </div>
                    </div>
                    <p class="hint-text" data-ko="페이지 구분은 쉼표(,)와 하이픈(-)으로 하세요. 예: 1,3,5-8" data-en="Use comma(,) and hyphen(-) to separate pages. Example: 1,3,5-8">페이지 구분은 쉼표(,)와 하이픈(-)으로 하세요. 예: 1,3,5-8</p>
                </div>

                <!-- 품질 옵션 -->
                <div class="option-group">
                    <label data-ko="품질 선택" data-en="Quality">품질 선택</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="mediumQuality" name="quality" value="150">
                            <div class="option-label-with-help">
                                <label for="mediumQuality" data-ko="중간 품질 (150 DPI)" data-en="Medium Quality (150 DPI)">중간 품질 (150 DPI)</label>
                                <span class="help-icon" data-tooltip="웹 사이트나 화면 보기용으로 적합합니다.&#10;&#10;파일 크기가 작고 처리 속도가 빠릅니다.&#10;&#10;권장: 웹 업로드, SNS 공유용">ⓘ</span>
                            </div>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="highQuality" name="quality" value="300" checked>
                            <div class="option-label-with-help">
                                <label for="highQuality" data-ko="고품질 (300 DPI)" data-en="High Quality (300 DPI)">고품질 (300 DPI)</label>
                                <span class="help-icon" data-tooltip="인쇄용으로 적합한 고품질 이미지입니다.&#10;&#10;선명하고 깨끗한 결과물을 얻을 수 있습니다.&#10;&#10;권장: 인쇄, 문서 보관용">ⓘ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 그레이스케일 옵션 -->
                <div class="option-group">
                    <div class="checkbox-option">
                        <input type="checkbox" id="grayscale">
                        <div class="option-label-with-help">
                            <label for="grayscale" data-ko="그레이스케일 (흑백)" data-en="Grayscale">그레이스케일 (흑백)</label>
                            <span class="help-icon" data-tooltip="컬러를 흑백으로 변환합니다.&#10;&#10;✓ 파일 크기 30-50% 감소&#10;✓ 흑백 인쇄 시 잉크 절약&#10;✓ 문서 보관용으로 적합">ⓘ</span>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" id="convertBtn" data-ko="JPEG로 변환" data-en="Convert to JPEG">JPEG로 변환</button>
                <button class="btn btn-secondary hidden" id="cancelConvertBtn" data-ko="변환 취소" data-en="Cancel">변환 취소</button>

                <div id="jpegProgress" class="progress-container hidden"></div>
            </div>
        </div>

        <!-- PDF Split 탭 -->
        <div id="split-tab" class="tab-content">
            <div class="upload-area" id="splitUploadArea">
                <input type="file" id="splitFileInput" class="file-input" accept=".pdf">
                <h3 data-ko="PDF 파일 선택" data-en="Select PDF File">PDF 파일 선택</h3>
                <p data-ko="클릭하거나 드래그하여 PDF 파일 업로드 (20MB 이하)" data-en="Click or drag to upload PDF file (max 20MB)">클릭하거나 드래그하여 PDF 파일 업로드 (20MB 이하)</p>
            </div>

            <div id="splitFileInfo" class="file-list hidden"></div>

            <div id="splitOptions" class="options hidden">
                <div class="option-group">
                    <label data-ko="분할 방식 (택1)" data-en="Split Method">분할 방식 (택1)</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="splitEqual" name="splitMethod" value="equal" checked>
                            <div class="option-label-with-help">
                                <label for="splitEqual" data-ko="균등 분할" data-en="Equal Division">균등 분할</label>
                                <span class="help-icon" data-tooltip="전체 PDF를 같은 크기로 나눕니다.&#10;&#10;예: 100페이지를 2개로 분할&#10;→ 50페이지 + 50페이지&#10;&#10;예: 100페이지를 3개로 분할&#10;→ 34페이지 + 33페이지 + 33페이지">ⓘ</span>
                            </div>
                            <input type="number" id="equalParts" class="page-input" min="2" max="100" value="2" placeholder="분할할 개수">
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="splitByPages" name="splitMethod" value="pages">
                            <div class="option-label-with-help">
                                <label for="splitByPages" data-ko="매 N페이지마다" data-en="Every N Pages">매 N페이지마다</label>
                                <span class="help-icon" data-tooltip="지정한 페이지 수마다 파일을 나눕니다.&#10;&#10;예: 10페이지마다 분할&#10;100페이지 PDF&#10;→ 1-10, 11-20, ... (총 10개 파일)&#10;&#10;예: 25페이지마다 분할&#10;100페이지 PDF&#10;→ 1-25, 26-50, 51-75, 76-100">ⓘ</span>
                            </div>
                            <input type="number" id="pagesPerSplit" class="page-input" min="1" max="100" value="10" placeholder="페이지 수" disabled>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="splitRange" name="splitMethod" value="range">
                            <div class="option-label-with-help">
                                <label for="splitRange" data-ko="페이지 범위" data-en="Page Ranges">페이지 범위</label>
                                <span class="help-icon" data-tooltip="원하는 페이지 범위만 추출합니다.&#10;&#10;쉼표(,)로 범위 구분&#10;하이픈(-)으로 범위 지정&#10;&#10;예: 1-10, 11-20 입력 시&#10;→ 1-10페이지 파일 1개&#10;→ 11-20페이지 파일 1개&#10;(총 2개 파일 생성)">ⓘ</span>
                            </div>
                            <input type="text" id="splitRanges" class="page-input" placeholder="1-10, 11-20" disabled>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="splitAll" name="splitMethod" value="all">
                            <div class="option-label-with-help">
                                <label for="splitAll" data-ko="모든 페이지 분리" data-en="Split All Pages">모든 페이지 분리</label>
                                <span class="help-icon" data-tooltip="각 페이지를 개별 PDF 파일로 분리합니다.&#10;&#10;예: 100페이지 PDF&#10;→ 1페이지 파일 100개 생성&#10;&#10;주의: 페이지가 많으면 시간이 걸립니다.">ⓘ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" id="splitBtn" data-ko="PDF 분할하기" data-en="Split PDF">PDF 분할하기</button>
                <button class="btn btn-secondary hidden" id="cancelSplitBtn" data-ko="분할 취소" data-en="Cancel">분할 취소</button>

                <div id="splitProgress" class="progress-container hidden"></div>
            </div>
        </div>
    </div>

    <script>
        // PDF.js worker 설정
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // 전역 변수
        let currentLang = 'ko';
        let currentTheme = 'light';
        let jpegFiles = [];
        let splitFile = null;
        let isProcessing = false;

        // 초기화
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
        });

        function initializeApp() {
            // 시스템 설정 감지
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                currentTheme = 'dark';
                document.documentElement.setAttribute('data-theme', 'dark');
                document.getElementById('themeToggle').textContent = '☀️';
            }

            // 브라우저 언어 감지
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang && !browserLang.startsWith('ko')) {
                toggleLanguage();
            }

            setupEventListeners();
        }

        function setupEventListeners() {
            // 유틸리티 버튼
            document.getElementById('langToggle').addEventListener('click', toggleLanguage);
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // 탭 버튼
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });

            // JPEG 탭
            setupJpegTab();

            // Split 탭
            setupSplitTab();
        }

        // 언어 전환
        function toggleLanguage() {
            currentLang = currentLang === 'ko' ? 'en' : 'ko';
            document.querySelectorAll('[data-ko]').forEach(el => {
                el.textContent = el.getAttribute('data-' + currentLang);
            });
            document.documentElement.setAttribute('lang', currentLang);
        }

        // 다크모드 전환
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.getElementById('themeToggle').textContent = currentTheme === 'light' ? '🌙' : '☀️';
        }

        // 탭 전환
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tab);
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `${tab}-tab`);
            });
        }

        // Toast 알림
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-message">${message}</div>
                <button class="toast-close">×</button>
            `;

            document.body.appendChild(toast);

            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.remove();
            });

            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // 모달 표시
        function showModal(title, message, onConfirm, onCancel) {
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';
            overlay.innerHTML = `
                <div class="modal">
                    <h2>${title}</h2>
                    <p>${message}</p>
                    <div class="modal-buttons">
                        <button class="modal-btn modal-btn-secondary" data-action="cancel">${currentLang === 'ko' ? '취소하기' : 'Cancel'}</button>
                        <button class="modal-btn modal-btn-primary pulse" data-action="confirm">${currentLang === 'ko' ? 'PDF 분할하기' : 'Split PDF'}</button>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);

            overlay.querySelector('[data-action="cancel"]').addEventListener('click', () => {
                overlay.remove();
                if (onCancel) onCancel();
            });

            overlay.querySelector('[data-action="confirm"]').addEventListener('click', () => {
                overlay.remove();
                if (onConfirm) onConfirm();
            });
        }

        // 파일 크기 포맷
        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }

        // 안전한 파일명 생성
        function sanitizeFilename(filename) {
            // 확장자 제거
            const name = filename.replace(/\.[^/.]+$/, '');

            // 안전한 문자만 남김: A-Z, a-z, 0-9, -, _
            let sanitized = name.replace(/[^a-zA-Z0-9가-힣\-_]/g, '_');

            // 연속된 언더스코어 제거
            sanitized = sanitized.replace(/_+/g, '_');

            // 앞뒤 언더스코어 제거
            sanitized = sanitized.replace(/^_+|_+$/g, '');

            // 빈 문자열이면 'output' 반환
            return sanitized || 'output';
        }

        // 날짜/시간 포맷 (YYYYMMDDHHmm)
        function getTimestamp() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            return `${year}${month}${day}${hours}${minutes}`;
        }

        // JPEG 탭 설정
        function setupJpegTab() {
            const uploadArea = document.getElementById('jpegUploadArea');
            const fileInput = document.getElementById('jpegFileInput');
            const fileList = document.getElementById('jpegFileList');
            const options = document.getElementById('jpegOptions');
            const convertBtn = document.getElementById('convertBtn');
            const cancelBtn = document.getElementById('cancelConvertBtn');

            // 업로드 영역 클릭
            uploadArea.addEventListener('click', () => fileInput.click());

            // 드래그 앤 드롭
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('drag-over');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                handleJpegFiles(Array.from(e.dataTransfer.files));
            });

            // 파일 선택
            fileInput.addEventListener('change', (e) => {
                handleJpegFiles(Array.from(e.target.files));
            });

            // 페이지 선택 라디오 버튼
            document.querySelectorAll('input[name="pageSelection"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    document.getElementById('rangeInput').disabled = radio.value !== 'range';
                    document.getElementById('specificInput').disabled = radio.value !== 'specific';
                });
            });

            // 변환 버튼
            convertBtn.addEventListener('click', convertToJpeg);
            cancelBtn.addEventListener('click', cancelConversion);
        }

        function handleJpegFiles(files) {
            const pdfFiles = files.filter(f => f.type === 'application/pdf');

            if (pdfFiles.length === 0) {
                showToast(currentLang === 'ko' ? 'PDF 파일만 업로드 가능합니다.' : 'Only PDF files are allowed.', 'error');
                return;
            }

            // 최대 3개 제한
            const totalFiles = jpegFiles.length + pdfFiles.length;
            if (totalFiles > 3) {
                showToast(currentLang === 'ko' ? '최대 3개까지만 업로드 가능합니다.' : 'Maximum 3 files allowed.', 'error');
                return;
            }

            // 파일 크기 체크 (20MB)
            for (const file of pdfFiles) {
                if (file.size > 20 * 1024 * 1024) {
                    showToast(currentLang === 'ko' ? `${file.name}의 크기가 20MB를 초과합니다.` : `${file.name} exceeds 20MB.`, 'error');
                    return;
                }
            }

            jpegFiles.push(...pdfFiles);
            displayJpegFiles();
        }

        function displayJpegFiles() {
            const fileList = document.getElementById('jpegFileList');
            const options = document.getElementById('jpegOptions');

            if (jpegFiles.length === 0) {
                fileList.classList.add('hidden');
                options.classList.add('hidden');
                return;
            }

            fileList.classList.remove('hidden');
            options.classList.remove('hidden');

            fileList.innerHTML = jpegFiles.map((file, index) => `
                <div class="file-item">
                    <div class="file-info">
                        <h4>${file.name}</h4>
                        <p>${formatBytes(file.size)}</p>
                    </div>
                    <button class="file-remove" onclick="removeJpegFile(${index})">×</button>
                </div>
            `).join('');
        }

        function removeJpegFile(index) {
            jpegFiles.splice(index, 1);
            displayJpegFiles();
        }

        async function convertToJpeg() {
            if (isProcessing || jpegFiles.length === 0) return;

            isProcessing = true;
            document.getElementById('convertBtn').disabled = true;
            document.getElementById('cancelConvertBtn').classList.remove('hidden');

            const progressContainer = document.getElementById('jpegProgress');
            progressContainer.classList.remove('hidden');
            progressContainer.innerHTML = '';

            // 설정 가져오기
            const pageSelection = document.querySelector('input[name="pageSelection"]:checked').value;
            const quality = parseInt(document.querySelector('input[name="quality"]:checked').value);
            const grayscale = document.getElementById('grayscale').checked;

            const scale = quality / 72; // DPI to scale

            let allResults = [];

            for (let fileIndex = 0; fileIndex < jpegFiles.length; fileIndex++) {
                const file = jpegFiles[fileIndex];

                // 진행률 아이템 생성
                const progressItem = document.createElement('div');
                progressItem.className = 'progress-item';
                progressItem.innerHTML = `
                    <div class="progress-header">
                        <span class="progress-filename">${file.name}</span>
                        <span class="progress-status" data-status="${fileIndex}">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" data-progress="${fileIndex}" style="width: 0%"></div>
                    </div>
                `;
                progressContainer.appendChild(progressItem);

                try {
                    // PDF 페이지 수 확인
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    const numPages = pdf.numPages;

                    // 페이지가 너무 많으면 경고
                    if (numPages >= 100) {
                        const shouldContinue = await new Promise(resolve => {
                            showModal(
                                currentLang === 'ko' ? '⚠️ 페이지가 너무 많습니다' : '⚠️ Too Many Pages',
                                currentLang === 'ko'
                                    ? `${numPages} 페이지입니다. 변환 시간이 오래 걸릴 수 있습니다.\n먼저 PDF를 분할하시겠습니까?`
                                    : `${numPages} pages detected. Conversion may take a long time.\nWould you like to split the PDF first?`,
                                () => {
                                    switchTab('split');
                                    resolve(false);
                                },
                                () => resolve(true)
                            );
                        });

                        if (!shouldContinue) {
                            isProcessing = false;
                            document.getElementById('convertBtn').disabled = false;
                            document.getElementById('cancelConvertBtn').classList.add('hidden');
                            return;
                        }
                    }

                    // 변환할 페이지 결정
                    const pagesToConvert = getPageNumbers(pageSelection, numPages);

                    if (pagesToConvert.length === 0) {
                        showToast(currentLang === 'ko' ? '유효한 페이지가 없습니다.' : 'No valid pages.', 'error');
                        continue;
                    }

                    // 페이지별 변환
                    const images = [];
                    for (let i = 0; i < pagesToConvert.length; i++) {
                        if (!isProcessing) break;

                        const pageNum = pagesToConvert[i];
                        const page = await pdf.getPage(pageNum);
                        const viewport = page.getViewport({ scale });

                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;

                        await page.render({
                            canvasContext: context,
                            viewport: viewport
                        }).promise;

                        // 그레이스케일 변환
                        if (grayscale) {
                            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                            const data = imageData.data;
                            for (let j = 0; j < data.length; j += 4) {
                                const gray = 0.299 * data[j] + 0.587 * data[j + 1] + 0.114 * data[j + 2];
                                data[j] = data[j + 1] = data[j + 2] = gray;
                            }
                            context.putImageData(imageData, 0, 0);
                        }

                        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.92));
                        images.push(blob);

                        // 진행률 업데이트
                        const progress = Math.round(((i + 1) / pagesToConvert.length) * 100);
                        updateProgress(fileIndex, progress);
                    }

                    allResults.push({
                        filename: sanitizeFilename(file.name),
                        images: images,
                        totalPages: pagesToConvert.length
                    });

                } catch (error) {
                    console.error('Error processing file:', error);
                    showToast(
                        currentLang === 'ko'
                            ? `${file.name} 처리 중 오류: ${error.message}`
                            : `Error processing ${file.name}: ${error.message}`,
                        'error'
                    );
                }
            }

            // 다운로드
            if (allResults.length > 0 && isProcessing) {
                await downloadJpegResults(allResults);
            }

            isProcessing = false;
            document.getElementById('convertBtn').disabled = false;
            document.getElementById('cancelConvertBtn').classList.add('hidden');
        }

        function getPageNumbers(selection, totalPages) {
            if (selection === 'all') {
                return Array.from({ length: totalPages }, (_, i) => i + 1);
            }

            if (selection === 'range') {
                const input = document.getElementById('rangeInput').value.trim();
                const match = input.match(/^(\d+)-(\d+)$/);
                if (!match) return [];
                const start = parseInt(match[1]);
                const end = parseInt(match[2]);
                if (start < 1 || end > totalPages || start > end) return [];
                return Array.from({ length: end - start + 1 }, (_, i) => start + i);
            }

            if (selection === 'specific') {
                const input = document.getElementById('specificInput').value.trim();
                const pages = new Set();
                const parts = input.split(',');

                for (const part of parts) {
                    const trimmed = part.trim();
                    if (trimmed.includes('-')) {
                        const [start, end] = trimmed.split('-').map(n => parseInt(n.trim()));
                        if (start && end && start <= end) {
                            for (let i = start; i <= end; i++) {
                                if (i >= 1 && i <= totalPages) pages.add(i);
                            }
                        }
                    } else {
                        const num = parseInt(trimmed);
                        if (num >= 1 && num <= totalPages) pages.add(num);
                    }
                }

                return Array.from(pages).sort((a, b) => a - b);
            }

            return [];
        }

        function updateProgress(fileIndex, percent) {
            const progressBar = document.querySelector(`[data-progress="${fileIndex}"]`);
            const progressStatus = document.querySelector(`[data-status="${fileIndex}"]`);

            if (progressBar) progressBar.style.width = percent + '%';
            if (progressStatus) progressStatus.textContent = percent + '%';
        }

        async function downloadJpegResults(results) {
            const timestamp = getTimestamp();

            // 총 이미지 수 계산
            const totalImages = results.reduce((sum, r) => sum + r.images.length, 0);

            if (totalImages <= 5) {
                // 5장 이하: 개별 다운로드 + ZIP 옵션
                for (const result of results) {
                    for (let i = 0; i < result.images.length; i++) {
                        const filename = `${timestamp}_${result.filename}_${i + 1}_of_${result.totalPages}.jpg`;
                        downloadBlob(result.images[i], filename);
                    }
                }
                showToast(
                    currentLang === 'ko'
                        ? `변환 완료! ${totalImages}개 이미지가 다운로드되었습니다.`
                        : `Complete! ${totalImages} images downloaded.`,
                    'success'
                );
            } else {
                // 6장 이상: ZIP만
                const zip = new JSZip();

                for (const result of results) {
                    for (let i = 0; i < result.images.length; i++) {
                        const filename = `${timestamp}_${result.filename}_${i + 1}_of_${result.totalPages}.jpg`;
                        zip.file(filename, result.images[i]);
                    }
                }

                const zipBlob = await zip.generateAsync({ type: 'blob' });
                downloadBlob(zipBlob, `${timestamp}_converted_images.zip`);

                showToast(
                    currentLang === 'ko'
                        ? `변환 완료! ZIP 파일로 다운로드되었습니다.`
                        : `Complete! Downloaded as ZIP file.`,
                    'success'
                );
            }
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function cancelConversion() {
            isProcessing = false;
            document.getElementById('cancelConvertBtn').classList.add('hidden');
            showToast(currentLang === 'ko' ? '변환이 취소되었습니다.' : 'Conversion cancelled.', 'warning');
        }

        // Split 탭 설정
        function setupSplitTab() {
            const uploadArea = document.getElementById('splitUploadArea');
            const fileInput = document.getElementById('splitFileInput');
            const fileInfo = document.getElementById('splitFileInfo');
            const options = document.getElementById('splitOptions');
            const splitBtn = document.getElementById('splitBtn');
            const cancelBtn = document.getElementById('cancelSplitBtn');

            uploadArea.addEventListener('click', () => fileInput.click());

            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('drag-over');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0) handleSplitFile(files[0]);
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) handleSplitFile(e.target.files[0]);
            });

            // 분할 방식 라디오 버튼
            document.querySelectorAll('input[name="splitMethod"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    document.getElementById('equalParts').disabled = radio.value !== 'equal';
                    document.getElementById('pagesPerSplit').disabled = radio.value !== 'pages';
                    document.getElementById('splitRanges').disabled = radio.value !== 'range';
                });
            });

            splitBtn.addEventListener('click', splitPdf);
            cancelBtn.addEventListener('click', cancelSplit);
        }

        function handleSplitFile(file) {
            if (file.type !== 'application/pdf') {
                showToast(currentLang === 'ko' ? 'PDF 파일만 업로드 가능합니다.' : 'Only PDF files allowed.', 'error');
                return;
            }

            if (file.size > 20 * 1024 * 1024) {
                showToast(currentLang === 'ko' ? '파일 크기가 20MB를 초과합니다.' : 'File exceeds 20MB.', 'error');
                return;
            }

            splitFile = file;
            displaySplitFile();
        }

        function displaySplitFile() {
            const fileInfo = document.getElementById('splitFileInfo');
            const options = document.getElementById('splitOptions');

            if (!splitFile) {
                fileInfo.classList.add('hidden');
                options.classList.add('hidden');
                return;
            }

            fileInfo.classList.remove('hidden');
            options.classList.remove('hidden');

            fileInfo.innerHTML = `
                <div class="file-item">
                    <div class="file-info">
                        <h4>${splitFile.name}</h4>
                        <p>${formatBytes(splitFile.size)}</p>
                    </div>
                    <button class="file-remove" onclick="removeSplitFile()">×</button>
                </div>
            `;
        }

        function removeSplitFile() {
            splitFile = null;
            displaySplitFile();
        }

        async function splitPdf() {
            if (isProcessing || !splitFile) return;

            isProcessing = true;
            document.getElementById('splitBtn').disabled = true;
            document.getElementById('cancelSplitBtn').classList.remove('hidden');

            const progressContainer = document.getElementById('splitProgress');
            progressContainer.classList.remove('hidden');
            progressContainer.innerHTML = `
                <div class="progress-item">
                    <div class="progress-header">
                        <span class="progress-filename">${splitFile.name}</span>
                        <span class="progress-status" id="splitStatus">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="splitProgressBar" style="width: 0%"></div>
                    </div>
                </div>
            `;

            try {
                const arrayBuffer = await splitFile.arrayBuffer();
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                const totalPages = pdfDoc.getPageCount();

                const splitMethod = document.querySelector('input[name="splitMethod"]:checked').value;
                const splits = calculateSplits(splitMethod, totalPages);

                if (splits.length === 0) {
                    showToast(currentLang === 'ko' ? '유효한 분할 범위가 없습니다.' : 'No valid split ranges.', 'error');
                    isProcessing = false;
                    document.getElementById('splitBtn').disabled = false;
                    document.getElementById('cancelSplitBtn').classList.add('hidden');
                    return;
                }

                const timestamp = getTimestamp();
                const baseName = sanitizeFilename(splitFile.name);
                const resultPdfs = [];

                for (let i = 0; i < splits.length; i++) {
                    if (!isProcessing) break;

                    const [start, end] = splits[i];
                    const newPdf = await PDFLib.PDFDocument.create();

                    for (let pageNum = start - 1; pageNum < end; pageNum++) {
                        const [copiedPage] = await newPdf.copyPages(pdfDoc, [pageNum]);
                        newPdf.addPage(copiedPage);
                    }

                    const pdfBytes = await newPdf.save();
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                    resultPdfs.push(blob);

                    // 진행률 업데이트
                    const progress = Math.round(((i + 1) / splits.length) * 100);
                    document.getElementById('splitProgressBar').style.width = progress + '%';
                    document.getElementById('splitStatus').textContent = progress + '%';
                }

                // 다운로드
                if (resultPdfs.length > 0 && isProcessing) {
                    const zip = new JSZip();
                    for (let i = 0; i < resultPdfs.length; i++) {
                        const filename = `${timestamp}_${baseName}_${i + 1}_of_${resultPdfs.length}.pdf`;
                        zip.file(filename, resultPdfs[i]);
                    }

                    const zipBlob = await zip.generateAsync({ type: 'blob' });
                    downloadBlob(zipBlob, `${timestamp}_${baseName}.zip`);

                    showToast(
                        currentLang === 'ko'
                            ? `분할 완료! ${resultPdfs.length}개 파일이 ZIP으로 다운로드되었습니다.`
                            : `Complete! ${resultPdfs.length} files downloaded as ZIP.`,
                        'success'
                    );
                }

            } catch (error) {
                console.error('Error splitting PDF:', error);
                showToast(
                    currentLang === 'ko'
                        ? `PDF 분할 중 오류: ${error.message}`
                        : `Error splitting PDF: ${error.message}`,
                    'error'
                );
            }

            isProcessing = false;
            document.getElementById('splitBtn').disabled = false;
            document.getElementById('cancelSplitBtn').classList.add('hidden');
        }

        function calculateSplits(method, totalPages) {
            const splits = [];

            if (method === 'equal') {
                const parts = parseInt(document.getElementById('equalParts').value);
                const pagesPerPart = Math.ceil(totalPages / parts);
                for (let i = 0; i < parts; i++) {
                    const start = i * pagesPerPart + 1;
                    const end = Math.min((i + 1) * pagesPerPart, totalPages);
                    if (start <= totalPages) splits.push([start, end]);
                }
            } else if (method === 'pages') {
                const pagesPerSplit = parseInt(document.getElementById('pagesPerSplit').value);
                for (let i = 0; i < totalPages; i += pagesPerSplit) {
                    splits.push([i + 1, Math.min(i + pagesPerSplit, totalPages)]);
                }
            } else if (method === 'range') {
                const input = document.getElementById('splitRanges').value.trim();
                const ranges = input.split(',');
                for (const range of ranges) {
                    const trimmed = range.trim();
                    const match = trimmed.match(/^(\d+)-(\d+)$/);
                    if (match) {
                        const start = parseInt(match[1]);
                        const end = parseInt(match[2]);
                        if (start >= 1 && end <= totalPages && start <= end) {
                            splits.push([start, end]);
                        }
                    }
                }
            } else if (method === 'all') {
                for (let i = 1; i <= totalPages; i++) {
                    splits.push([i, i]);
                }
            }

            return splits;
        }

        function cancelSplit() {
            isProcessing = false;
            document.getElementById('cancelSplitBtn').classList.add('hidden');
            showToast(currentLang === 'ko' ? '분할이 취소되었습니다.' : 'Split cancelled.', 'warning');
        }
    </script>
</body>
</html>
